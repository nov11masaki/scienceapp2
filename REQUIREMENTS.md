# ScienceBuddy 要件定義書

**プロジェクト名**: ScienceBuddy（サイエンスバディ）  
**バージョン**: 2.0  
**最終更新日**: 2026年1月26日  
**作成者**: nov11masaki  

---

## 1. プロジェクト概要

### 1.1 目的
小学4年生の理科学習において、子どもたちが「変化」に着目し、科学的思考を育むためのAI対話型学習支援システムを提供する。

### 1.2 背景
- 小学校理科教育において、実験の予想と考察が形式的になりがち
- 児童の経験に基づいた思考プロセスの可視化が不十分
- 教員が個々の児童の理解度を把握するのが困難
- 科学的語彙の獲得プロセスが定量的に評価されていない

### 1.3 スコープ
- **対象学年**: 小学4年生
- **対象単元**: 熱と温度に関する5単元
- **対象ユーザー**: 児童（学習者）、教員（管理者）
- **利用環境**: PC、タブレット、スマートフォン

---

## 2. ステークホルダー

| ステークホルダー | 役割 | 主な要求事項 |
|---------------|------|------------|
| **児童（学習者）** | システムの主要利用者 | 使いやすい対話インターフェース、予想・考察の記録 |
| **教員** | 学習状況の把握・分析 | 児童の学習データ確認、分析レポート、指導支援 |
| **学校管理者** | システム運用管理 | データセキュリティ、コスト管理 |
| **開発者** | システム開発・保守 | 保守性、拡張性、ドキュメント整備 |

---

## 3. 機能要件

### 3.1 児童向け機能（学習者機能）

#### 3.1.1 認証・ログイン
- **FR-001**: クラス選択機能（1組〜4組、研究室）
- **FR-002**: 出席番号選択機能（各クラス1〜30番）
- **FR-003**: セッション管理による自動ログイン維持
- **FR-004**: 同一IDの重複ログイン検出・警告

#### 3.1.2 単元選択
- **FR-005**: 5つの学習単元から選択可能
  - 金属のあたたまり方
  - 水のあたたまり方
  - 空気の温度と体積
  - 水を冷やし続けた時の温度と様子
  - 金属の温度と体積
- **FR-006**: 選択した単元に応じた課題文の自動表示
- **FR-007**: 単元変更時の会話リセット機能

#### 3.1.3 予想段階（AI対話）
- **FR-008**: AI（gpt-4o-mini）との自然言語対話
- **FR-009**: 児童の経験に基づいた根拠の引き出し
- **FR-010**: 温める・冷やす両方の予想を引き出す
- **FR-011**: ユーザー主導の「予想をまとめる」ボタン
- **FR-012**: AI自動まとめの禁止（ユーザー操作時のみ）
- **FR-013**: 子どもの言葉を尊重した要約生成
- **FR-014**: 会話履歴の自動保存

#### 3.1.4 考察段階（AI対話）
- **FR-015**: 予想との比較を促す対話
- **FR-016**: 実験結果の受け止めと深掘り
- **FR-017**: 日常生活との結びつけ
- **FR-018**: ユーザー主導の「考察をまとめる」ボタン
- **FR-019**: 考察の自動生成と保存

#### 3.1.5 入力方法
- **FR-020**: キーボード入力（標準）
- **FR-021**: 50音キーボード（ひらがな入力支援）
  - 濁点・半濁点の循環入力
  - トグル式ON/OFF切り替え
- **FR-022**: レスポンシブデザイン（スマホ・タブレット対応）

#### 3.1.6 学習履歴
- **FR-024**: 過去の予想・考察の時系列表示
- **FR-025**: 単元別・ステージ別のフィルタリング
- **FR-026**: 会話データの詳細表示（モーダル）
- **FR-027**: 日本時間（JST）での表示

### 3.2 教員向け機能

#### 3.2.1 認証・権限管理
- **FR-028**: 教員専用ログイン機能
- **FR-029**: クラス別アクセス権限管理
  - 全クラス管理者（teacher）
  - クラス別担任（4100, 4200, 4300, 4400, 5000）

#### 3.2.2 ダッシュボード
- **FR-030**: 学習進捗一覧表示
- **FR-031**: 児童別の学習状況確認
- **FR-032**: 単元別の学習完了状況

#### 3.2.3 学習ログ確認
- **FR-033**: 日付別学習ログの表示
- **FR-034**: 児童別フィルタリング機能
- **FR-035**: 会話履歴の詳細表示
- **FR-036**: 予想・考察の全文確認

#### 3.2.4 分析ダッシュボード
- **FR-037**: 理科用語含有率の計算・表示
- **FR-038**: 語彙獲得率の追跡
  - 生活語彙から科学用語への変容分析
- **FR-039**: クラスタリング分析
  - 類似回答のグループ化
  - OpenAI Embeddings API使用
- **FR-040**: AIインサイト生成
  - クラス全体の傾向分析
  - 指導ポイントの提案
- **FR-041**: 個別児童の詳細分析ページ
- **FR-042**: 単元別分析レポート

#### 3.2.5 データエクスポート
- **FR-043**: CSV形式での一括エクスポート
- **FR-044**: JSON形式での一括エクスポート
- **FR-045**: 日付範囲指定によるフィルタリング

#### 3.2.6 ログ管理
- **FR-046**: ログ削除機能（パスワード保護）
- **FR-047**: エラーログの確認

---

## 4. 非機能要件

### 4.1 パフォーマンス
- **NFR-001**: AI応答時間は5秒以内
- **NFR-002**: ページ読み込み時間は2秒以内
- **NFR-003**: 同時アクセス100ユーザーまでサポート
- **NFR-004**: 要約生成は30秒以内（非同期処理時）

### 4.2 可用性
- **NFR-005**: システム稼働率99%以上（本番環境）
- **NFR-006**: データバックアップは日次実行
- **NFR-007**: セッション復旧機能によるブラウザリロード対応

### 4.3 セキュリティ
- **NFR-008**: HTTPS通信の必須化（本番環境）
- **NFR-009**: APIキーの環境変数による管理
- **NFR-010**: 教員認証の実装
- **NFR-011**: 同一IDの重複ログイン防止
- **NFR-012**: ログ削除時のパスワード認証

### 4.4 保守性
- **NFR-013**: コードの可読性（PEP 8準拠）
- **NFR-014**: プロンプトの外部ファイル管理
- **NFR-015**: 単元追加の容易性
- **NFR-016**: ログレベルによるデバッグ支援

### 4.5 拡張性
- **NFR-017**: 新規単元の追加が容易
- **NFR-018**: AI モデルの変更が容易
- **NFR-019**: ストレージバックエンドの切り替え対応（ローカル/GCS/Firestore）

### 4.6 互換性
- **NFR-020**: ブラウザ対応（Chrome, Safari, Edge最新版）
- **NFR-021**: モバイル端末対応（iOS, Android）
- **NFR-022**: レスポンシブデザインの実装

### 4.7 データ管理
- **NFR-023**: 会話データの永続化
- **NFR-024**: セッションデータの永続化
- **NFR-025**: 学習進捗データの永続化
- **NFR-026**: 日本時間（JST）での一貫した時刻管理

---

## 5. データ要件

### 5.1 データモデル

#### 5.1.1 学習ログ（learning_log）
```json
{
  "log_type": "prediction_chat | reflection_chat | prediction_summary | reflection_summary",
  "timestamp": "ISO 8601形式（JST）",
  "student_id": "整数（例: 4101）",
  "class": "整数（1-5）",
  "unit": "単元名",
  "stage": "prediction | reflection",
  "conversation": [
    {
      "role": "user | assistant",
      "content": "メッセージ内容"
    }
  ],
  "summary": "要約テキスト（summary時のみ）"
}
```

#### 5.1.2 学習進捗（learning_progress）
```json
{
  "student_id": {
    "unit": {
      "prediction_completed": "boolean",
      "prediction_timestamp": "ISO 8601形式",
      "reflection_completed": "boolean",
      "reflection_timestamp": "ISO 8601形式"
    }
  }
}
```

#### 5.1.3 セッションデータ（session_storage）
```json
{
  "student_id": {
    "unit": {
      "stage": {
        "timestamp": "ISO 8601形式",
        "conversation": [
          {
            "role": "user | assistant",
            "content": "メッセージ内容"
          }
        ]
      }
    }
  }
}
```

#### 5.1.4 サマリーストレージ（summary_storage）
```json
{
  "student_id": {
    "unit": {
      "prediction_summary": {
        "summary": "予想のまとめ",
        "timestamp": "ISO 8601形式",
        "conversation": [...]
      },
      "reflection_summary": {
        "summary": "考察のまとめ",
        "timestamp": "ISO 8601形式",
        "conversation": [...]
      }
    }
  }
}
```

### 5.2 データ保存先

| 環境 | 保存先 | 形式 |
|------|--------|------|
| **開発環境** | ローカルJSON | ファイルシステム |
| **本番環境** | Google Cloud Storage | JSON（バケット） |
| **オプション** | Firestore | NoSQLドキュメント |

### 5.3 データ保持期間
- **学習ログ**: 無期限（手動削除のみ）
- **セッションデータ**: ログイン中 + 30日間
- **サマリーデータ**: 無期限

---

## 6. 制約事項

### 6.1 技術的制約
- **CON-001**: OpenAI API の利用制限に依存
- **CON-002**: Web Speech API はブラウザ依存（Chrome推奨）
- **CON-003**: GCS利用時はGCPプロジェクトが必要
- **CON-004**: 非同期処理時はRedis必須

### 6.2 運用制約
- **CON-005**: 同時接続数はCloud Runインスタンス数に依存
- **CON-006**: API コストは使用量に応じて増加
- **CON-007**: ログファイルの肥大化に注意

### 6.3 教育的制約
- **CON-008**: 小学4年生の読解レベルに合わせた表現
- **CON-009**: AIの回答は教育的配慮が必要
- **CON-010**: 予想・考察は子どもの自発性を最優先

---

## 7. ユースケース

### 7.1 UC-001: 児童が予想を立てる

**アクター**: 児童  
**前提条件**: クラス・出席番号でログイン済み  
**主フロー**:
1. 児童が単元を選択
2. システムが課題文を表示
3. AIが初期メッセージを送信
4. 児童がAIと対話
5. 児童が「予想をまとめる」ボタンを押す
6. システムが要約を生成
7. システムが予想を保存

**代替フロー**:
- 4a. 児童の発言が不十分 → エラーメッセージ表示
- 6a. 要約生成失敗 → エラー表示、再試行

**事後条件**: 予想が保存され、考察段階へ進める

### 7.2 UC-002: 教員が学習状況を確認

**アクター**: 教員  
**前提条件**: 教員アカウントでログイン済み  
**主フロー**:
1. 教員がダッシュボードにアクセス
2. システムが学習進捗を表示
3. 教員が特定の児童を選択
4. システムが児童の詳細情報を表示
5. 教員が会話履歴を確認

**事後条件**: なし

### 7.3 UC-003: 教員が分析レポートを確認

**アクター**: 教員  
**前提条件**: 教員アカウントでログイン済み、学習データ存在  
**主フロー**:
1. 教員が分析ダッシュボードにアクセス
2. システムが理科用語含有率を計算
3. システムがクラスタリング分析を実行
4. システムがAIインサイトを生成
5. 教員が分析結果を確認

**事後条件**: なし

---

## 8. インターフェース要件

### 8.1 ユーザーインターフェース
- **UI-001**: Bootstrap 5ベースのレスポンシブデザイン
- **UI-002**: クリーンなデザイン（白ベース、ライトブルーアクセント）
- **UI-003**: カード形式の選択UI
- **UI-004**: チャット形式の対話UI
- **UI-005**: アクセシビリティ対応（ラベル、ARIA属性）

### 8.2 外部API
- **API-001**: OpenAI API（Chat Completions）
- **API-002**: OpenAI API（Embeddings） - 分析機能
- **API-003**: Web Speech API（音声認識）

### 8.3 データベースインターフェース
- **DB-001**: ローカルJSON（開発環境）
- **DB-002**: Google Cloud Storage（本番環境）
- **DB-003**: Firestore（オプション）

---

## 9. 受け入れ基準

### 9.1 機能受け入れ基準
- ✅ 全ての機能要件（FR-001〜FR-047）が実装済み
- ✅ 単元選択から予想・考察まで一連のフローが正常動作
- ✅ 教員ダッシュボードですべてのデータが確認可能
- ✅ 分析機能が正確に動作

### 9.2 品質受け入れ基準
- ✅ 全ての非機能要件（NFR-001〜NFR-026）を満たす
- ✅ エラーハンドリングが適切に実装
- ✅ ログが適切に記録される
- ✅ ドキュメントが整備されている

### 9.3 テスト受け入れ基準
- ✅ 手動テストで主要フローが正常動作
- ✅ 異常系テストで適切なエラー処理
- ✅ 複数ブラウザでの動作確認
- ✅ モバイル端末での動作確認

---

## 10. リスクと課題

| リスク | 影響度 | 対策 |
|--------|--------|------|
| OpenAI API障害 | 高 | エラーハンドリング、代替フロー |
| API コスト超過 | 中 | 使用量モニタリング、キャッシュ導入 |
| データ損失 | 高 | 定期バックアップ、GCS利用 |
| パフォーマンス低下 | 中 | 非同期処理、キャッシュ |
| セキュリティ侵害 | 高 | HTTPS、認証強化 |

---

## 11. 今後の拡張予定

### 機能拡張（予定）
- [ ] 他学年への対応（5年生、6年生）
- [ ] 他教科への展開（算数、社会）
- [ ] 自動テスト導入
- [ ] CI/CD パイプラインの強化

---

## 12. 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|----------|------|---------|--------|
| 1.0 | 2025年12月 | 初版作成 | nov11masaki |
| 2.0 | 2026年1月26日 | 分析機能追加、要件更新 | nov11masaki |

---

## 13. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトオーナー | - | - | - |
| 開発責任者 | nov11masaki | 2026/01/26 | ✓ |
| 教育監修者 | - | - | - |

---

**文書終了**
